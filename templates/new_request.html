{% extends "base.html" %}
{% block title %}New Request{% endblock %}

{% block content %}
<div class="card">
  <div class="row">
    <h2>New Leave Request</h2>
    <div class="right muted">Workday = {{ '%.2f'|format(workday) }} h</div>
  </div>
  <p class="muted" style="margin:.25rem 0 1rem 0;">
    For hourly requests, you may either enter total hours <em>or</em> pick start/end times (15-minute increments).
  </p>

  <form method="post" action="{{ url_for('new_request') }}">
    <div class="form-grid-3">
      <div>
        <label for="kind">Kind</label>
        <select id="kind" name="kind">
          <option value="annual">Annual</option>
          <option value="sick">Sick</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div>
        <label for="mode">Mode</label>
        <select id="mode" name="mode">
          <option value="hourly">Hourly</option>
          <option value="daily">Daily</option>
        </select>
      </div>

      <div>
        <label for="hours">Hours (optional for hourly)</label>
        <input id="hours" name="hours" type="number" step="0.25" placeholder="e.g. 2.5">
      </div>

      <div>
        <label for="start_date">Start date</label>
        <input id="start_date" name="start_date" type="date" required>
      </div>
      <div>
        <label for="end_date">End date</label>
        <input id="end_date" name="end_date" type="date" required>
      </div>
      <div>
        <label>&nbsp;</label>
        <label style="display:flex;align-items:center;gap:.5rem;">
          <input type="checkbox" name="school_related" value="1"> School-related (no deduction)
        </label>
      </div>

      <!-- Quarter-hour time pickers -->
      <div>
        <label>Start time (optional)</label>
        <div class="form-row" style="gap:6px;">
          <select name="start_time_hour" class="input-sm" style="max-width:90px;">
            <option value="">HH</option>
            {% for h in range(0,24) %}
              <option value="{{ '%02d' % h }}">{{ '%02d' % h }}</option>
            {% endfor %}
          </select>
          <select name="start_time_min" class="input-sm" style="max-width:90px;">
            <option value="">MM</option>
            {% for m in ['00','15','30','45'] %}
              <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
          </select>
          <input type="hidden" name="start_time" id="start_time_hidden">
        </div>
      </div>

      <div>
        <label>End time (optional)</label>
        <div class="form-row" style="gap:6px;">
          <select name="end_time_hour" class="input-sm" style="max-width:90px;">
            <option value="">HH</option>
            {% for h in range(0,24) %}
              <option value="{{ '%02d' % h }}">{{ '%02d' % h }}</option>
            {% endfor %}
          </select>
          <select name="end_time_min" class="input-sm" style="max-width:90px;">
            <option value="">MM</option>
            {% for m in ['00','15','30','45'] %}
              <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
          </select>
          <input type="hidden" name="end_time" id="end_time_hidden">
        </div>
      </div>

      <div style="grid-column: 1 / -1;">
        <label for="reason">Reason (optional)</label>
        <textarea id="reason" name="reason" placeholder="Add any notes for your adminâ€¦"></textarea>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="btn" type="submit">Submit Request</button>
      <a class="btn ghost" href="{{ NAV.my_requests }}">Back to My Requests</a>
    </div>
  </form>
</div>

{% block extra_scripts %}
<script>
  // Build HH:MM hidden values from the two selects (quarter-minute)
  function updateHidden(idPrefix) {
    const hSel = document.querySelector(`select[name="${idPrefix}_hour"]`);
    const mSel = document.querySelector(`select[name="${idPrefix}_min"]`);
    const hidden = document.getElementById(`${idPrefix}_hidden`);
    if (hSel && mSel && hidden) {
      const h = hSel.value;
      const m = mSel.value;
      hidden.value = (h && m) ? `${h}:${m}` : "";
    }
  }
  ['start_time','end_time'].forEach(prefix => {
    const hSel = document.querySelector(`select[name="${prefix}_hour"]`);
    const mSel = document.querySelector(`select[name="${prefix}_min"]`);
    [hSel, mSel].forEach(el => el && el.addEventListener('change', () => updateHidden(prefix)));
  });
</script>
{% endblock %}
{% endblock %}
