{% extends "base.html" %}
{% block title %}New Request{% endblock %}

{% block content %}
<div class="card">
  <h1 style="margin-top:0;">New Leave Request</h1>

  <form method="post" class="form-grid">
    <div class="row">
      <div class="col">
        <label>Kind</label>
        <select name="kind" class="input">
          <option value="annual">Annual</option>
          <option value="sick">Sick</option>
        </select>
      </div>
      <div class="col">
        <label>Mode</label>
        <select name="mode" class="input" id="mode">
          <option value="hourly" selected>Hourly</option>
          <option value="daily">Daily ({{ workday }}h)</option>
          <option value="halfday">Half Day ({{ '%.2f'|format(workday/2) }}h)</option> <!-- NEW -->
        </select>
      </div>
      <div class="col">
        <label>School-related (no deduction)</label>
        <input type="checkbox" name="school_related" value="1" style="transform:scale(1.2); margin-top:.5rem;">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>Start date</label>
        <input class="input" type="date" name="start_date" required>
      </div>
      <div class="col">
        <label>End date</label>
        <input class="input" type="date" name="end_date" required>
      </div>
      <div class="col only-hourly">
        <label>Hours (optional)</label>
        <input class="input" type="number" step="0.25" name="hours" placeholder="e.g. 3.5">
      </div>
    </div>

    <!-- 12-hour time pickers for hourly -->
    <div class="row only-hourly">
      <div class="col">
        <label>Start time</label>
        <div class="time-row">
          <select name="start_h" class="input-sm">
            {% for h in range(1,13) %}<option value="{{ h }}">{{ h }}</option>{% endfor %}
          </select>
          <span>:</span>
          <select name="start_m" class="input-sm">
            {% for m in ["00","15","30","45"] %}<option value="{{ m }}">{{ m }}</option>{% endfor %}
          </select>
          <select name="start_ampm" class="input-sm">
            <option>AM</option><option>PM</option>
          </select>
        </div>
      </div>
      <div class="col">
        <label>End time</label>
        <div class="time-row">
          <select name="end_h" class="input-sm">
            {% for h in range(1,13) %}<option value="{{ h }}">{{ h }}</option>{% endfor %}
          </select>
          <span>:</span>
          <select name="end_m" class="input-sm">
            {% for m in ["00","15","30","45"] %}<option value="{{ m }}">{{ m }}</option>{% endfor %}
          </select>
          <select name="end_ampm" class="input-sm">
            <option>AM</option><option>PM</option>
          </select>
        </div>
        <div class="muted" style="margin-top:.25rem;">(15-minute increments)</div>
      </div>
    </div>

    <div class="row">
      <div class="col-full">
        <label>Reason</label>
        <textarea class="input" name="reason" rows="3" placeholder="Optional"></textarea>
      </div>
    </div>

    <div class="row">
      <div class="right">
        <button class="btn" type="submit">Submit Request</button>
      </div>
    </div>
  </form>
</div>

<style>
.form-grid .row { display:flex; gap:1rem; margin-bottom:1rem; align-items:flex-end; flex-wrap:wrap; }
.form-grid .col { flex:1 1 220px; min-width:220px; }
.form-grid .col-full { flex:1 1 100%; }
.input { width:100%; padding:.6rem .7rem; border:1px solid #d0d7de; border-radius:8px; }
.input-sm { padding:.4rem .5rem; border:1px solid #d0d7de; border-radius:8px; width:auto; }
.time-row { display:flex; gap:.4rem; align-items:center; }
.only-hourly { display:block; }
</style>

<script>
  const modeSel = document.getElementById('mode');
  const toggleHourly = () => {
    document.querySelectorAll('.only-hourly').forEach(el => {
      el.style.display = modeSel.value === 'hourly' ? 'block' : 'none';
    });
  };
  modeSel.addEventListener('change', toggleHourly);
  toggleHourly();
</script>
{% endblock %}
