{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Manage Users</h2>

  <form method="post" action="{{ url_for('admin_create_user') }}">
    <h3>Create User</h3>
    <input name="username" placeholder="Username" required>
    <input type="email" name="email" placeholder="Email">
    <input type="number" step="0.25" name="hours_balance" placeholder="Hours Balance" value="160">
    <select name="role">
      <option value="faculty_staff">Faculty/Staff</option>
      <option value="admin">Admin</option>
    </select>
    <input type="password" name="password" placeholder="Password" required>
    <button type="submit">Create</button>
  </form>
</div>

<div class="card">
  <h3>Existing Users</h3>
  <table>
    <thead><tr><th>Username</th><th>Email</th><th>Role</th><th>Hours</th><th>Actions</th></tr></thead>
    <tbody>
    {% for u in users %}
      <tr>
        <form method="post" action="{{ url_for('admin_update_user', user_id=u.id) }}">
          <td><input name="username" value="{{ u.username }}"></td>
          <td><input name="email" value="{{ u.email or '' }}"></td>
          <td>
            <select name="role">
              <option value="faculty_staff" {% if u.role == "faculty_staff" %}selected{% endif %}>Faculty/Staff</option>
              <option value="admin" {% if u.role == "admin" %}selected{% endif %}>Admin</option>
            </select>
          </td>
          <td>
            <input type="number" step="0.25" name="hours_balance" value="{{ "%.2f"|format(u.hours_balance) }}"
              class="{% if u.hours_balance < 0 %}negative{% endif %}">
          </td>
          <td>
            <button type="submit">Update</button>
        </form>
        <form method="post" action="{{ url_for('admin_reset_password', user_id=u.id) }}" style="display:inline">
          <input type="password" name="new_password" placeholder="New Password">
          <button>Reset PW</button>
        </form>
        <form method="post" action="{{ url_for('admin_delete_user', user_id=u.id) }}" style="display:inline"
              onsubmit="return confirm('Delete this user?');">
          <button>Delete</button>
        </form>
          </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
