{% extends "base.html" %}
{% block title %}Manage Users{% endblock %}

{% block content %}
  <div class="card">
    <h1>Manage Users</h1>
    <form method="get" action="{{ url_for('manage_users') }}">
      <input type="text" name="q" value="{{ q or '' }}" placeholder="Search username">
      <button type="submit">Search</button>
    </form>
  </div>

  <div class="card">
    <h2>Create User</h2>
    <form method="post" action="{{ url_for('admin_create_user') }}">
      <label>Username <input name="username" required></label>
      <label>Password <input type="password" name="password" required></label>
      <label>Email <input type="email" name="email"></label>
      <label>Role
        <select name="role">
          <option value="faculty_staff">Staff</option>
          <option value="admin">Admin</option>
        </select>
      </label>
      <label>Hours balance <input type="number" step="0.25" name="hours_balance" value="160"></label>
      <button type="submit">Create</button>
    </form>
  </div>

  <div class="card">
    <h2>All Users</h2>
    {% if users %}
      <table>
        <thead>
          <tr><th>Username</th><th>Email</th><th>Role</th><th>Hours</th><th>Actions</th></tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.username }}</td>
            <td>{{ u.email or 'â€”' }}</td>
            <td>{{ u.role }}</td>
            <td>{{ u.hours_balance }}</td>
            <td>
              <!-- update / reset / delete forms -->
              <form method="post" action="{{ url_for('admin_update_user', user_id=u.id) }}">
                <input name="username" value="{{ u.username }}">
                <input name="email" value="{{ u.email or '' }}">
                <select name="role">
                  <option value="faculty_staff" {% if u.role=='faculty_staff' %}selected{% endif %}>Staff</option>
                  <option value="admin" {% if u.role=='admin' %}selected{% endif %}>Admin</option>
                </select>
                <input name="hours_balance" type="number" step="0.25" value="{{ u.hours_balance }}">
                <button type="submit">Update</button>
              </form>
              <form method="post" action="{{ url_for('admin_reset_password', user_id=u.id) }}">
                <input type="password" name="new_password" placeholder="New password" required>
                <button type="submit">Reset PW</button>
              </form>
              <form method="post" action="{{ url_for('admin_delete_user', user_id=u.id) }}" onsubmit="return confirm('Delete {{ u.username }}?')">
                <button type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No users found.</p>
    {% endif %}
  </div>
{% endblock %}
