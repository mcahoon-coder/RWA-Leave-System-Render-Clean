{% extends "base.html" %}
{% block title %}Manage Users{% endblock %}

{% block content %}
<div class="card">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
    <h2 style="margin:0;">Manage Users</h2>

    <!-- Search by username (partial matches) -->
    <form method="get" action="{{ url_for('manage_users') }}" style="display:flex; gap:8px; align-items:center;">
      <input
        type="text"
        name="q"
        placeholder="Search usernameâ€¦"
        value="{{ q or '' }}"
        style="min-width:220px;"
      />
      <button class="btn" type="submit">Search</button>
      <a class="btn btn-ghost" href="{{ url_for('manage_users') }}">Clear</a>
    </form>
  </div>
</div>

<div class="card">
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th style="width:18%;">Username</th>
          <th style="width:10%;">Role</th>
          <th style="width:14%;">Hours Balance</th>
          <th style="width:22%;">Email</th>
          <th style="width:36%;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td><strong>{{ u.username }}</strong></td>
          <td>{{ u.role }}</td>
          <td>{{ '%.2f'|format(u.hours_balance or 0) }}</td>
          <td>
            <!-- Update email -->
            <form class="inline" method="post" action="{{ url_for('admin_update_user', user_id=u.id) }}">
              <input
                type="email"
                name="email"
                value="{{ u.email or '' }}"
                placeholder="user@example.com"
                style="max-width:260px;"
              />
              <button class="btn" type="submit">Save Email</button>
            </form>
          </td>
          <td>
            <!-- Reset password -->
            <form class="inline" method="post" action="{{ url_for('admin_reset_password', user_id=u.id) }}" style="display:flex; gap:8px; align-items:center;">
              <input
                type="password"
                name="new_password"
                placeholder="New password"
                required
                style="max-width:220px;"
              />
              <button class="btn btn-warning" type="submit" title="Set a new password for this user">Reset Password</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="5" class="muted">No users found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
