{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>Leave History for {{ user.username }}</h2>

    {% if requests %}
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Kind</th>
                <th>Mode</th>
                <th>Dates</th>
                <th>Times</th>
                <th>Hours</th>
                <th>Status</th>
                <th>School?</th>
                <th>Substitutes</th>
            </tr>
        </thead>
        <tbody>
        {% for r in requests %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.kind }}</td>
                <td>{{ r.mode }}</td>
                <td>{{ r.start_date }} → {{ r.end_date }}</td>
                <td>
                    {% if r.start_time %}{{ r.start_time|h12 }}{% else %}-{% endif %}
                    →
                    {% if r.end_time %}{{ r.end_time|h12 }}{% else %}-{% endif %}
                </td>
                <td>{{ "%.2f"|format(r.hours) }}</td>
                <td>
                    {% if r.status == "Approved" %}
                        <span class="badge badge-green">{{ r.status }}</span>
                    {% elif r.status == "Pending" %}
                        <span class="badge badge-blue">{{ r.status }}</span>
                    {% elif r.status == "Disapproved" %}
                        <span class="badge badge-red">{{ r.status }}</span>
                    {% else %}
                        {{ r.status }}
                    {% endif %}
                </td>
                <td>{{ "Yes" if r.is_school_related else "No" }}</td>
                <td>
                    {% if r.subs %}
                        {% for s in r.subs %}
                            {{ s.name }} ({{ "%.2f"|format(s.hours) }}h){% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% elif r.substitute %}
                        {{ r.substitute }}
                    {% else %}
                        –
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No requests found for this user.</p>
    {% endif %}

    <div class="mt-3">
        <a href="{{ url_for('my_requests') }}" class="btn btn-secondary">← Back to All Requests</a>
    </div>
</div>
{% endblock %}
