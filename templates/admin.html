{% extends "base.html" %}
{% block title %}Admin{% endblock %}

{% block content %}
<div class="card">
  <div class="row" style="align-items:center;">
    <h1 style="margin:0;">Admin</h1>
    <div class="right">
      <a class="btn sm" href="{{ url_for('manage_users') }}">User Management</a>
      <a class="btn sm ghost" href="{{ url_for('calendar') }}">Team Calendar</a>
      <a class="btn sm ghost" href="{{ url_for('admin_email_test') }}">Send Test Email</a>
    </div>
  </div>
</div>

<!-- Approvals (BUTTONS, no dropdowns) -->
<div class="card">
  <div class="row" style="align-items:center;">
    <h3 style="margin:0;">Approvals <span class="muted">(BUTTONS)</span></h3>
  </div>

  {% if pending and pending|length > 0 %}
  <table class="table-tight" style="font-size:.95rem;">
    <thead>
      <tr>
        <th>User</th>
        <th>Date(s)</th>
        <th>Kind</th>
        <th>Mode</th>
        <th>Hours</th>
        <th>School</th>
        <th>Substitutes</th>
        <th style="width:1%;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for r in pending %}
      <tr>
        <td>{{ r.user.staff_name or r.user.username }}</td>
        <td>
          {{ r.start_date }}{% if r.end_date != r.start_date %} â†’ {{ r.end_date }}{% endif %}
          {% if r.start_time and r.end_time %}
            <div class="muted">{{ r.start_time|h12 }}â€“{{ r.end_time|h12 }}</div>
          {% endif %}
        </td>
        <td>{{ r.kind|capitalize }}</td>
        <td>{{ r.mode|capitalize }}</td>
        <td>{{ '%.2f'|format(r.hours) }}h</td>
        <td>{{ 'Yes' if r.is_school_related else 'No' }}</td>
        <td>
          {% if r.subs and r.subs|length %}
            {% for s in r.subs %}
              <div class="muted">{{ s.name }} ({{ '%.2f'|format(s.hours) }}h)</div>
            {% endfor %}
          {% elif r.substitute %}
            <div class="muted">{{ r.substitute }}</div>
          {% else %}
            <span class="muted">â€”</span>
          {% endif %}
        </td>
        <td style="white-space:nowrap;">
          <form method="post" action="{{ url_for('approve', req_id=r.id) }}" style="display:inline;">
            <button class="btn sm" type="submit">Approve</button>
          </form>
          <form method="post" action="{{ url_for('disapprove', req_id=r.id) }}" style="display:inline;">
            <button class="btn sm danger" type="submit">Disapprove</button>
          </form>
          <!-- Quick add sub (optional inline) -->
          <form method="post" action="{{ url_for('add_substitute', req_id=r.id) }}" class="row" style="margin-top:6px;">
            <input class="input-sm" name="sub_name" placeholder="Substitute name" style="max-width:160px;">
            <input class="input-sm" name="sub_hours" type="number" step="0.25" placeholder="hrs" style="max-width:90px;">
            <button class="btn sm ghost" type="submit">Add Sub</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="muted">No pending requests ðŸŽ‰</p>
  {% endif %}
</div>
{% endblock %}
