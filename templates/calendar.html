{% extends "base.html" %}
{% block content %}
<h2>Calendar</h2>

<div class="card" style="padding: 1rem;">
  <div style="text-align: right; margin-bottom: 0.5rem;">
    <button onclick="printCalendar()" class="btn btn-primary">üñ®Ô∏è Print Calendar</button>
  </div>

  <div id="calendar"></div>
</div>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const el = document.getElementById('calendar');
  const cal = new FullCalendar.Calendar(el, {
    timeZone: 'America/New_York',
    initialView: 'dayGridMonth',
    height: 'auto',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,dayGridWeek,dayGridDay'
    },
    fixedWeekCount: false,
    firstDay: 0,
    displayEventTime: false,
    events: '/calendar-data',
    eventDidMount: function(info) {
      info.el.title = info.event.title;
    }
  });
  cal.render();
});

function printCalendar() {
  const printContents = document.getElementById('calendar').outerHTML;
  const newWin = window.open('', '', 'width=1000,height=700');
  newWin.document.write(`
    <html>
      <head>
        <title>Calendar Print</title>
        <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
        <style>
          @page {
            size: landscape;
            margin: 0.4in;
          }
          body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            transform: scale(0.9);
            transform-origin: top center;
          }
          #calendar {
            max-width: 100%;
            margin: auto;
          }
          h2 {
            text-align: center;
            margin-bottom: 10px;
          }
        </style>
      </head>
      <body>
        <h2>Calendar</h2>
        ${printContents}
      </body>
    </html>
  `);
  newWin.document.close();
  newWin.focus();
  newWin.print();
  newWin.close();
}
</script>
{% endblock %}
