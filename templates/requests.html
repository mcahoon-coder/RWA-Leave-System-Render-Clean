{% extends "base.html" %}
{% block title %}My Requests{% endblock %}
{% block content %}

<div class="card" style="margin-bottom:12px;">
  <h1 style="margin-top:0;">My Requests</h1>

  <!-- Balance -->
  <div style="margin-bottom:1rem;">
    {% set bal = current_user.hours_balance or 0 %}
    {% set is_neg = bal < 0 %}
    <div style="font-size:1.4rem; font-weight:700; color: {{ '#dc2626' if is_neg else '#065f46' }};">
      Balance: {{ '%.2f'|format(bal) }}h
    </div>
  </div>

  <!-- Results -->
  <table class="table-tight" style="font-size:.95rem;">
    <thead>
      <tr>
        <th>Kind</th>
        <th>Mode</th>
        <th>Dates</th>
        <th>Hours</th>
        <th>School</th>
        <th>Status</th>
        <th style="width:1%;">Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for r in reqs %}
      <tr>
        <td>{{ r.kind|capitalize }}</td>
        <td>{{ r.mode|capitalize }}</td>
        <td style="white-space:nowrap;">
          {{ r.start_date }} → {{ r.end_date }}
          {% if r.start_time or r.end_time %}
            <div class="muted" style="font-size:.8rem;">
              {{ r.start_time or '-' }} – {{ r.end_time or '-' }}
            </div>
          {% endif %}
        </td>
        <td style="text-align:center;">{{ '%.2f'|format(r.hours or 0) }}</td>
        <td style="text-align:center;">
          {% if r.is_school_related %}
            <span class="badge green">Yes</span>
          {% else %}
            <span class="badge amber">No</span>
          {% endif %}
        </td>
        <td>
          {% set st = r.status %}
          {% if st=='Approved' %}<span class="badge green">Approved</span>
          {% elif st=='Pending' %}<span class="badge blue">Pending</span>
          {% elif st=='Disapproved' %}<span class="badge red">Disapproved</span>
          {% elif st=='Cancelled' %}<span class="badge">Cancelled</span>
          {% else %}{{ st }}{% endif %}
        </td>
        <td style="white-space:nowrap;">
          {% if r.status == 'Pending' %}
            <form method="post" action="{{ url_for('cancel', req_id=r.id) }}" style="display:inline;">
              <button class="btn secondary sm" type="submit">Cancel</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% else %}
      <tr><td colspan="7" class="muted">No requests found.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
