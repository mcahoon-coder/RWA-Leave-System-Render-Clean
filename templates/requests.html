{# templates/my_requests.html #}
{% extends "base.html" %}
{% block title %}My Requests{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-3">My Requests</h2>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Kind</th>
          <th>Mode</th>
          <th>Dates</th>
          <th>Hours</th>
          <th>Status</th>
          <th>School?</th>
          <th>Substitutes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {# Loop is resilient: uses the first non-empty iterable passed by the view #}
        {% for req in (requests or leave_requests or my_requests or leaves) %}
        <tr>
          <td>{{ req.id }}</td>
          <td>{{ req.user.username if req.user else "" }}</td>
          <td>{{ req.kind }}</td>
          <td>{{ req.mode }}</td>

          {# Dates with optional time range (only addition) #}
          <td>
            {{ req.start_date }} → {{ req.end_date }}
            {% if req.start_time and req.end_time %}
              ({{ req.start_time.strftime("%I:%M %p").lstrip('0') }} – {{ req.end_time.strftime("%I:%M %p").lstrip('0') }})
            {% endif %}
          </td>

          <td>{{ "%.2f"|format(req.hours) if req.hours is not none else "" }}</td>
          <td>{{ req.status }}</td>

          <td>
            {% if req.school is boolean or req.school in [True, False] %}
              {{ "Yes" if req.school else "No" }}
            {% else %}
              {{ req.school }}
            {% endif %}
          </td>

          <td>
            {% if req.substitutes and req.substitutes|length > 0 %}
              <ul class="mb-0">
                {% for sub in req.substitutes %}
                  <li>
                    {{ sub.name }}
                    {% if sub.hours %} — {{ sub.hours }}h{% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              &ndash;
            {% endif %}
          </td>

          <td>
            {# Keep your existing routes; these names are placeholders if you already had them #}
            <div class="d-flex gap-2">
              {% if req.can_add_sub %}
                <a class="btn btn-sm btn-outline-primary" href="{{ url_for('add_substitute', request_id=req.id) }}">Add Sub</a>
              {% endif %}
              {% if req.can_cancel %}
                <a class="btn btn-sm btn-outline-danger" href="{{ url_for('cancel_request', request_id=req.id) }}">Cancel</a>
              {% endif %}
              {# Add/keep any other action buttons you already use #}
            </div>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="10" class="text-center text-muted">No requests to display.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {# If you use pagination, keep your existing block; this is optional and harmless #}
  {% if pagination %}
    <nav aria-label="My Requests pagination" class="mt-3">
      <ul class="pagination">
        {% if pagination.prev_num %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('my_requests', page=pagination.prev_num) }}">Previous</a>
          </li>
        {% endif %}
        <li class="page-item disabled">
          <span class="page-link">Page {{ pagination.page }} of {{ pagination.pages }}</span>
        </li>
        {% if pagination.next_num %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('my_requests', page=pagination.next_num) }}">Next</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}
