{% extends "base.html" %}
{% block content %}
<h1>My Requests{% if is_admin %} (All Users){% endif %}</h1>

<form method="get" action="/requests" style="margin-bottom:12px;">
  <label>Status</label>
  <select name="status">
    <option value="all" {% if status=='all' %}selected{% endif %}>All</option>
    <option value="Pending" {% if status=='Pending' %}selected{% endif %}>Pending</option>
    <option value="Approved" {% if status=='Approved' %}selected{% endif %}>Approved</option>
    <option value="Disapproved" {% if status=='Disapproved' %}selected{% endif %}>Disapproved</option>
    <option value="Cancelled" {% if status=='Cancelled' %}selected{% endif %}>Cancelled</option>
  </select>

  <label>Start</label>
  <input type="date" name="start" value="{{ start }}">

  <label>End</label>
  <input type="date" name="end" value="{{ end }}">

  <button class="btn" type="submit">Filter</button>
</form>

{% if reqs %}
  <table>
    <thead>
      <tr>
        <th>ID</th>
        {% if is_admin %}<th>User</th>{% endif %}
        <th>Kind</th><th>Mode</th><th>Hours</th><th>Status</th><th>Start</th><th>End</th><th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for r in reqs %}
      <tr>
        <td>{{ r.id }}</td>
        {% if is_admin %}<td>{{ r.user.username }}</td>{% endif %}
        <td>{{ r.kind }}</td>
        <td>{{ r.mode }}</td>
        <td>{{ "%.1f"|format(r.hours) }}</td>
        <td>{{ r.status }}</td>
        <td>{{ r.start_date }}</td>
        <td>{{ r.end_date }}</td>
        <td>
          {% if is_admin and r.status == 'Pending' %}
            <form method="post" action="/requests/{{ r.id }}/approve" style="display:inline;">
              <button class="btn primary" type="submit">Approve</button>
            </form>
            <form method="post" action="/requests/{{ r.id }}/disapprove" style="display:inline;">
              <button class="btn danger" type="submit">Disapprove</button>
            </form>
          {% endif %}
          {% if (current_user.is_authenticated and r.user_id == current_user.id) or is_admin %}
            {% if r.status in ['Pending','Approved'] %}
              <form method="post" action="/requests/{{ r.id }}/cancel" style="display:inline;">
                <button class="btn" type="submit">Cancel</button>
              </form>
            {% endif %}
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No requests match your filters.</p>
{% endif %}
{% endblock %}
