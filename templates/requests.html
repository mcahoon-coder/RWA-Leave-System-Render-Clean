{% extends "base.html" %}
{% block title %}Requests · RWA Leave{% endblock %}
{% block content %}
  <h1>Requests</h1>

  <form method="get" action="{{ NAV.my_requests }}" style="margin-bottom:12px;">
    <label>Status
      <select name="status">
        {% set s = (status or 'all')|lower %}
        {% for x in ['all','Pending','Approved','Disapproved','Cancelled'] %}
          <option value="{{ x }}" {% if x|lower == s %}selected{% endif %}>{{ x }}</option>
        {% endfor %}
      </select>
    </label>
    <label style="margin-left:10px;">Start <input type="date" name="start" value="{{ start or '' }}"></label>
    <label style="margin-left:10px;">End <input type="date" name="end" value="{{ end or '' }}"></label>
    <button type="submit" style="margin-left:10px;">Filter</button>
  </form>

  {% set items = reqs or requests %}
  {% if items and items|length %}
    <table border="1" cellpadding="6" cellspacing="0">
      <thead>
        <tr>
          <th>ID</th><th>User</th><th>Kind</th><th>Mode</th><th>Hours</th>
          <th>Status</th><th>Start</th><th>End</th><th>Reason</th>
          {% if is_admin %}<th>Actions</th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for r in items %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.user.username }}</td>
          <td>{{ r.kind }}</td>
          <td>{{ r.mode }}</td>
          <td>{{ '%.2f'|format(r.hours) }}</td>
          <td>{{ r.status }}</td>
          <td>{{ r.start_date }}</td>
          <td>{{ r.end_date }}</td>
          <td>{{ r.reason }}</td>
          {% if is_admin %}
          <td>
            {% if r.status == 'Pending' %}
              <form method="post" action="{{ url_for('approve', req_id=r.id) }}" style="display:inline;">
                <button type="submit">Approve</button>
              </form>
              <form method="post" action="{{ url_for('disapprove', req_id=r.id) }}" style="display:inline;">
                <button type="submit">Disapprove</button>
              </form>
            {% else %}
              —
            {% endif %}
            {% if r.status != 'Cancelled' %}
              <form method="post" action="{{ url_for('cancel', req_id=r.id) }}" style="display:inline;">
                <button type="submit">Cancel</button>
              </form>
            {% endif %}
          </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No requests match your filters.</p>
  {% endif %}
{% endblock %}
